!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).Stick=i()}(this,function(){"use strict";!function(t){if(t&&"undefined"!=typeof window){var i=document.createElement("style");i.setAttribute("media","screen"),i.innerHTML=t,document.head.appendChild(i)}}("@keyframes stickFadeIn {\n  0% {\n    opacity: 0;\n    transform: translateX(-20px);\n  }\n  100% {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n.vue-stick-outer {\n  position: relative;\n}\n.vue-stick-outer .stick-fade-in {\n  animation: stickFadeIn 0.5s ease both;\n}\n");var t={props:{list:{type:Array,default:[]},imgKey:{type:String,default:""},columnWidth:{type:Number,default:280},animationClass:{type:String,default:"stick-fade-in"},loadTriggerDistance:{type:Number,default:1e3},columnSpacing:{type:Number,default:10}},data:function(){return{count:0,outerHeight:200,columnWidthInUse:0,columnCount:0,localList:[],lastRowBottomPosition:[],lastTriggerScrollTime:0,widgetIDMax:0,resizeTimer:null}},template:'<div ref="stickOuter" class="vue-stick-outer" :style="{\n\theight: outerHeight + \'px\'\n}">\n\t<div\n\t\tclass="vue-stick-item"\n\t\tv-for="item in localList"\n\t\t:key="item.id"\n\t\t:ref="\'widget-\' + item.id"\n\t\t:style="{\n\t\t\tposition: item.style.position,\n\t\t\tvisibility: item.style.visibility,\n\t\t\twidth: Math.round(item.style.width) + \'px\',\n\t\t\ttop: Math.round(item.style.top) + \'px\',\n\t\t\tleft: Math.round(item.style.left) + \'px\'\n\t\t}"\n\t>\n\t\t<slot v-bind:data="item.data" />\n\t</div>\n</div>',mounted:function(){this.lastRowBottomPosition=[],document.addEventListener("scroll",this.scrollListener),window.addEventListener("resize",this.resizeListener),this.buildLayout(),this.syncList()},methods:{buildLayout:function(){var t=this.$refs.stickOuter.clientWidth;this.lastRowBottomPosition=[],this.columnCount=Math.max(Math.floor((t+this.columnSpacing)/(this.columnWidth+this.columnSpacing)),1),1===this.columnCount?this.columnWidthInUse=t:this.columnWidthInUse=(t+this.columnSpacing)/this.columnCount-this.columnSpacing},refresh:function(){var t=this;this.buildLayout(),this.localList.forEach(function(i){i.style.top=0,i.style.left=0,i.style.width=t.columnWidthInUse,i.style.visibility="hidden"}),this.$nextTick(function(){t.lastRowBottomPosition=[],t.localList.forEach(function(i){var e=t.$refs["widget-"+i.id][0];i.prepared&&t.fixItemPosition(e,i)})})},scrollListener:function(){var t=(new Date).getTime();t-this.lastTriggerScrollTime>500&&Math.max(document.documentElement.scrollTop,document.body.scrollTop)+window.innerHeight+this.loadTriggerDistance>=document.body.scrollHeight&&(this.$emit("onSrollEnd"),this.lastTriggerScrollTime=t)},resizeListener:function(){var t=this;clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){t.refresh()},500)},syncList:function(){var t=this,i=this.localList.map(function(t){return t.data});if(this.list.forEach(function(e){-1===i.indexOf(e)&&t.addItem(e)}),this.list.length<this.localList.length){console.log("有节点被删了！");for(var e=this.localList.length-1;e>=0;e--)-1===this.list.indexOf(this.localList[e].data)&&this.localList.splice(e,1);t.refresh()}},addItem:function(t){var i={id:this.widgetIDMax++,style:{position:"relative",top:0,left:0,width:this.columnWidthInUse,visibility:"hidden"},prepared:!1,data:t},e=this;this.localList.push(i),function(t,i){if(t){var e=new Image;e.onerror=e.onload=s;var n=setInterval(function(){e.width>1&&s()},2);e.src=t}else setTimeout(i,0);function s(){clearInterval(n),i&&i(),i=null}}(t[this.imgKey],function(){var t=e.$refs["widget-"+i.id][0];i.prepared=!0,e.fixItemPosition(t,i)})},fixItemPosition:function(t,i){var e,n=0;if(t&&i){var s=t.clientHeight;this.lastRowBottomPosition.length<this.columnCount?(e=this.lastRowBottomPosition.length,this.lastRowBottomPosition.push(s)):(n=Math.min.apply(null,this.lastRowBottomPosition),e=this.lastRowBottomPosition.indexOf(n),n+=this.columnSpacing),i.style.position="absolute",i.style.visibility="visible",i.style.top=n,i.style.left=e*(this.columnWidthInUse+this.columnSpacing),t.classList.add(this.animationClass),setTimeout(function(){t.classList.remove(this.animationClass)},1e3),this.lastRowBottomPosition[e]=n+s,this.outerHeight=Math.max.apply(null,this.lastRowBottomPosition)+this.columnSpacing}}},watch:{list:function(){this.syncList()}},beforeDestroy:function(){document.removeEventListener("scroll",this.scrollListener),window.removeEventListener("resize",this.resizeListener)}};return{component:t,install:function(i){i.component("Stick",t)}}});
//# sourceMappingURL=vue-stick.umd.js.map
