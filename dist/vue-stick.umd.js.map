{"version":3,"file":"vue-stick.umd.js","sources":["../src/vue-stick.js","../src/utils.js"],"sourcesContent":["import './style.less'\nimport { getImgSize, getScrollTop } from './utils.js'\n\nvar component = {\n\tprops: {\n\t\tlist: {\n\t\t\ttype: Array,\n\t\t\tdefault: []\n\t\t},\n\t\tcolumnWidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 280\n\t\t},\n\t\tanimationClass: {\n\t\t\ttype: String,\n\t\t\tdefault: 'stick-fade-in'\n\t\t},\n\t\tloadTriggerDistance: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1000\n\t\t},\n\t\tcolumnSpacing: {\n\t\t\ttype: Number,\n\t\t\tdefault: 10\n\t\t}\n\t},\n\tdata: function () {\n\t\treturn {\n\t\t\tcount: 0,\n\t\t\touterHeight: 200,\n\n\t\t\tcolumnWidthInUse: 0,\n\t\t\tcolumnCount: 0,\n\n\t\t\tlocalList: [],\n\t\t\tlastRowBottomPosition: [],\n\t\t\tlastTriggerScrollTime: 0,\n\n\t\t\twidgetIDMax: 0,\n\t\t\tresizeTimer: null\n\t\t}\n\t},\n\trender: function (createElement) {\n\t\tvar me = this\n\t\treturn createElement(\n\t\t\t'div',\n\t\t\t{\n\t\t\t\tclass: ['vue-stick-outer'],\n\t\t\t\tref: 'stickOuter',\n\t\t\t\tstyle: {\n\t\t\t\t\theight: this.outerHeight + 'px'\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis.localList.map(function (item) {\n\t\t\t\treturn createElement(\n\t\t\t\t\t'div',\n\t\t\t\t\t{\n\t\t\t\t\t\tclass: ['vue-stick-item'],\n\t\t\t\t\t\tref: 'widget-' + item.id,\n\t\t\t\t\t\tkey: item.id,\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tposition: item.style.position,\n\t\t\t\t\t\t\tvisibility: item.style.visibility,\n\t\t\t\t\t\t\twidth: Math.round(me.columnWidthInUse) + 'px',\n\t\t\t\t\t\t\ttop: Math.round(item.style.top) + 'px',\n\t\t\t\t\t\t\tleft: Math.round(item.style.left) + 'px'\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\tme.$scopedSlots.default({\n\t\t\t\t\t\t\tdata: item.data\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t)\n\t\t\t})\n\t\t)\n\t},\n\tmounted: function () {\n\t\tthis.lastRowBottomPosition = [];\n\t\tdocument.addEventListener('scroll', this.scrollListener)\n\t\twindow.addEventListener('resize', this.resizeListener)\n\t\tthis.buildLayout();\n\t\tthis.syncList()\n\t},\n\tmethods: {\n\t\tbuildLayout: function () {\n\t\t\tvar width = this.$refs.stickOuter.clientWidth;\n\t\t\tthis.lastRowBottomPosition = [];\n\t\t\tthis.columnCount = Math.max(Math.floor((width + this.columnSpacing) / (this.columnWidth + this.columnSpacing)), 1);\n\t\t\tif (this.columnCount === 1) {\n\t\t\t\tthis.columnWidthInUse = width\n\t\t\t} else {\n\t\t\t\tthis.columnWidthInUse = (width + this.columnSpacing) / this.columnCount - this.columnSpacing\n\t\t\t}\n\n\t\t},\n\t\trefresh: function () {\n\t\t\tvar me = this\n\t\t\tthis.buildLayout();\n\n\t\t\tthis.localList.forEach(function (widget) {\n\t\t\t\twidget.style.visibility = 'hidden'\n\t\t\t})\n\t\t\tthis.$nextTick(function () {\n\t\t\t\tme.lastRowBottomPosition = []\n\t\t\t\tme.localList.forEach(function (widget) {\n\t\t\t\t\tvar node = me.$refs['widget-' + widget.id]\n\t\t\t\t\tif (widget.prepared) {\n\t\t\t\t\t\tme.fixItemPosition(node, widget)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t},\n\t\tscrollListener: function () {\n\t\t\tvar now = new Date().getTime()\n\n\t\t\tif (now - this.lastTriggerScrollTime > 500 && (getScrollTop() + window.innerHeight + this.loadTriggerDistance >= document.body.scrollHeight)) {\n\t\t\t\tthis.$emit('onScrollEnd')\n\t\t\t\tthis.lastTriggerScrollTime = now;\n\t\t\t}\n\t\t},\n\t\tresizeListener: function () {\n\t\t\tvar me = this\n\t\t\tclearTimeout(this.resizeTimer);\n\t\t\tthis.resizeTimer = setTimeout(function () {\n\t\t\t\tme.refresh();\n\t\t\t}, 500);\n\t\t},\n\t\tsyncList: function () {\n\t\t\tvar me = this\n\t\t\tvar listInProps = this.list\n\t\t\tvar listInScreen = this.localList.map(function (item) {\n\t\t\t\treturn item.data\n\t\t\t})\n\t\t\t// 查找增量数据\n\t\t\tlistInProps.forEach(function (item) {\n\t\t\t\tif (listInScreen.indexOf(item) === -1) {\n\t\t\t\t\tme.addItem(item)\n\t\t\t\t}\n\t\t\t})\n\t\t\t// 逆序查找被删除的数据\n\t\t\tvar hasDeletedData = false\n\t\t\tfor (var index = listInScreen.length - 1; index >= 0; index--) {\n\t\t\t\tif (listInProps.indexOf(listInScreen[index]) === -1) {\n\t\t\t\t\thasDeletedData = true\n\t\t\t\t\tthis.localList.splice(index, 1)\n\t\t\t\t}\n\t\t\t}\n\t\t\thasDeletedData && me.refresh()\n\t\t},\n\t\taddItem: function (item) {\n\t\t\tvar me = this\n\t\t\tvar widget = {\n\t\t\t\tid: this.widgetIDMax++,\n\t\t\t\tstyle: {\n\t\t\t\t\tposition: 'relative',\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\twidth: this.columnWidthInUse,\n\t\t\t\t\tvisibility: 'hidden'\n\t\t\t\t},\n\t\t\t\tprepared: false,\n\t\t\t\tdata: item\n\t\t\t}\n\n\t\t\tthis.localList.push(widget)\n\t\t\tthis.$nextTick(function () {\n\t\t\t\tvar widgetNode = me.$refs['widget-' + widget.id]\n\t\t\t\tvar imgNode = widgetNode.querySelector('img')\n\t\t\t\tvar imgSrc = imgNode ? imgNode.getAttribute('src') : ''\n\t\t\t\t\n\t\t\t\tgetImgSize(imgSrc, function () {\n\t\t\t\t\t// 标记已准备好\n\t\t\t\t\twidget.prepared = true\n\t\t\t\t\twidgetNode.classList.add(me.animationClass)\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\twidgetNode.classList.remove(me.animationClass)\n\t\t\t\t\t}, 1000)\n\t\t\t\t\tme.fixItemPosition(widgetNode, widget)\n\t\t\t\t});\n\t\t\t})\n\t\t},\n\t\tfixItemPosition: function (node, widget) {\n\t\t\tvar columnIndex\n\t\t\tvar top = 0\n\t\t\tif (!node || !widget) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tvar widgetHeight = node.clientHeight\n\t\t\tif (this.lastRowBottomPosition.length < this.columnCount) {\n\t\t\t\t//第一排item\n\t\t\t\tcolumnIndex = this.lastRowBottomPosition.length;\n\t\t\t\tthis.lastRowBottomPosition.push(widgetHeight);\n\t\t\t} else {\n\t\t\t\t//其余\n\t\t\t\ttop = Math.min.apply(null, this.lastRowBottomPosition);\n\t\t\t\tcolumnIndex = this.lastRowBottomPosition.indexOf(top);\n\t\t\t\ttop = top + this.columnSpacing;\n\t\t\t}\n\t\t\twidget.style.position = 'absolute'\n\t\t\twidget.style.visibility = 'visible'\n\t\t\twidget.style.top = top\n\t\t\twidget.style.left = columnIndex * (this.columnWidthInUse + this.columnSpacing)\n\n\t\t\tthis.lastRowBottomPosition[columnIndex] = top + widgetHeight\n\t\t\tthis.outerHeight = Math.max.apply(null, this.lastRowBottomPosition) + this.columnSpacing\n\t\t}\n\t},\n\twatch: {\n\t\tlist: function () {\n\t\t\tthis.syncList()\n\t\t}\n\t},\n\tbeforeDestroy: function () {\n\t\tdocument.removeEventListener('scroll', this.scrollListener)\n\t\twindow.removeEventListener('resize', this.resizeListener)\n\t}\n}\n\n\nexport default {\n\tcomponent,\n\tinstall: function (Vue) {\n\t\tVue.component('Stick', component);\n\t}\n}\n","//图片预加载\nexport function getImgSize(src,callback){\n  if(!src){\n    setTimeout(callback, 0)\n    return;\n  }\n  var img = new Image();\n  function End(){\n    clearInterval(timer);\n    callback && callback();\n    callback = null;\n  }\n  img.onerror = img.onload = End;\n  var timer = setInterval(function(){\n    img.width>1 && End();\n  },2);\n  img.src=src;\n}\n\n/**\n * 获取浏览器滚动尺寸\n *  为了兼容firefox\n */\nexport function getScrollTop(){\n  return Math.max(document.documentElement.scrollTop, document.body.scrollTop);\n}"],"names":["component","props","list","type","Array","default","columnWidth","Number","animationClass","String","loadTriggerDistance","columnSpacing","data","count","outerHeight","columnWidthInUse","columnCount","localList","lastRowBottomPosition","lastTriggerScrollTime","widgetIDMax","resizeTimer","render","createElement","me","this","class","ref","style","height","map","item","id","key","position","visibility","width","Math","round","top","left","$scopedSlots","mounted","document","addEventListener","scrollListener","window","resizeListener","buildLayout","syncList","methods","$refs","stickOuter","clientWidth","max","floor","refresh","forEach","widget","$nextTick","node","prepared","fixItemPosition","now","Date","getTime","documentElement","scrollTop","body","innerHeight","scrollHeight","$emit","clearTimeout","setTimeout","listInProps","listInScreen","indexOf","addItem","hasDeletedData","index","length","splice","push","widgetNode","imgNode","querySelector","src","callback","img","Image","onerror","onload","End","timer","setInterval","clearInterval","getImgSize","getAttribute","classList","add","remove","columnIndex","widgetHeight","clientHeight","min","apply","watch","beforeDestroy","removeEventListener","install","Vue"],"mappings":"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"}